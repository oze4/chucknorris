<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Chucky Norris</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" sizes="16x16" href="">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.2/css/bootstrap-select.min.css">
</head>

<body>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha384-tsQFqpEReu7ZLhBV2VZlAu7zcOV+rXbYlF2cqB8txI/8aZajjp4Bqd+V6D5IgvKT"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.2/js/bootstrap-select.min.js" integrity="sha384-xuUB7RiCht6gdWrTGeTHiVRhtXiryS5fNys9jjr4bhj4S0mmw4jICW287qdx15RV"
        crossorigin="anonymous"></script>


    <div class='container' style='margin-top:40px'>
        <div class="card">
            <div class='card-header'>
                <h5 class='card-title'>Chucky Norris Jokes</h5>
            </div>
            <div class="card-body">
                <div class='row card-top-row'>
                    <div class='col-md-12'>
                        <label for="category_dropdown">Select Category</label>
                        <div>
                            <select class='jokeselectpicker' name="category_dropdown" id="category-dropdown">
                            </select>
                        </div>
                    </div>
                </div>
                <div class='row' style="margin-top:10px;">
                    <div class='col-md-12'>
                        <p class='card-text' style='height:300px;' id='joke-result'></p>
                    </div>
                </div>
            </div>
            <div class='card-footer'>
                <button class='btn btn-primary float-right' type="button" id='get-joke'>Click me for a Chuck Norris
                    joke</button>
            </div>
        </div>
    </div>


    <script type='text/javascript'>
        $(document).ready(function () {
            $.fn.extend({
                getCategories: function (callback) {
                    return $.ajax('https://api.chucknorris.io/jokes/categories', {
                        method: 'GET',
                        success: (result) => {
                            $('<option></option>').val(undefined).html("-").appendTo(this); // add blank placeholder
                            result.push('random'); // append 'random' selection                            
                            result.sort(); // sort alphabetically
                            $.each(result, (index, item) => {
                                $('<option></option>').val(item).html(item).appendTo(
                                    this);
                            })
                        },
                    })
                },
                getJoke: function (category) {
                    let url = 'https://api.chucknorris.io/jokes/random';
                    if (category !== undefined && category !== 'random') {
                        url = url + '?category=' + category;
                    }
                    $.ajax(url, {
                        context: this,
                        method: "GET",
                        beforeSend: function () {
                            this.html('Loading...');
                        },
                        success: function (result) {
                            this.html('<strong>' + result['value'] + '</strong>');
                        },
                        error: function (err) {
                            let e =
                                '<div style="background-color:red;"><strong> Something went wrong! Chuck Norris is not pleased..' + 
                                'We encountered the following error:<p>' +
                                err.error + '</p></strong></div>'
                            this.html(e);
                        }
                    });
                    return this;
                }
            });

            $('.jokeselectpicker').attr('disabled', true);
            $('.jokeselectpicker').selectpicker({
                size: 10,
                noneSelectedText: "Loading...",
            });
            $('.jokeselectpicker').getCategories().then(function () {
                $('.jokeselectpicker').selectpicker('refresh').removeAttr('disabled');
            });

            $('#get-joke').on('click', function () {
                let selectedCategory = $('#category-dropdown').val();
                $('#joke-result').getJoke(selectedCategory);
            });

        });
    </script>
    <style>
        button[disabled] {
            cursor: not-allowed;
        }

        .card-top-row {
            margin-bottom: 10px;
        }
    </style>
</body>

</html>
